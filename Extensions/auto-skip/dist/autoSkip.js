var autoSkip=(()=>{var r,n=class{static getToken(){return Spicetify.Platform.AuthorizationAPI._tokenProvider({preferCached:!0}).then(e=>e.accessToken)}static async getTrackDetails(e){return fetch("https://api.spotify.com/v1/tracks/"+e,{headers:{Authorization:"Bearer "+await n.getToken()}}).then(e=>e.json())}static async getTrackFeatures(e){return fetch("https://api.spotify.com/v1/audio-features/"+e,{headers:{Authorization:"Bearer "+await n.getToken()}}).then(e=>e.json())}static async searchSpotify(e,t="track"){return fetch(`https://api.spotify.com/v1/search?q=${e}&type=${t}&limit=15`,{headers:{Authorization:"Bearer "+await n.getToken()}}).then(e=>e.json())}static async addTrackToQueue(e){var t;await Spicetify.CosmosAsync.put("sp://player/v2/main/queue",{queue_revision:null==(t=Spicetify.Queue)?void 0:t.queueRevision,next_tracks:[{uri:e,provider:"queue",metadata:{is_queued:!0}},...null==(t=Spicetify.Queue)?void 0:t.nextTracks.map(e=>({uri:e.contextTrack.uri,provider:e.provider,metadata:{is_queued:"queue"===e.provider}}))],prev_tracks:null==(e=Spicetify.Queue)?void 0:e.prevTracks})}};function e(){var e;if(r)return r;try{var t=JSON.parse(null!=(e=localStorage.getItem("auto-skip:skips"))?e:"{}");if(t&&"object"==typeof t)return r=t;throw""}catch(e){return localStorage.setItem("auto-skip:skips","{}"),r={}}}function t(e){var t=e.replace(/\(.+?\)/g,"").replace(/\[.+?\]/g,"").replace(/\s\-\s.+?$/,"").trim();return""==t?e:t}async function i(e){const t=await n.searchSpotify(e),i=await n.getTrackFeatures("?ids="+t.tracks.items.map(e=>e.uri.split(":")[2]).join()).catch(e=>console.error(e));for(const a of t.tracks.items)if(a.features=i.audio_features.filter(e=>e.uri===a.uri)[0],0==c(a).length)return console.log("Adding to queue",a),await n.addTrackToQueue(a.uri),a;return null}async function o(e){e=e.split(":")[2];const t=await n.getTrackDetails(e).catch(e=>console.error(e));return t&&t.name?(t.features=await n.getTrackFeatures(e).catch(e=>console.error(e)),t):null}function c(i,a=null){return Object.entries(e()).filter(([e,t])=>t&&d[e].check(i,a)).map(e=>e[0])}var d={skipAcoustic:{menuTitle:"Acoustic Songs",check:t=>{var e;return["acoustic","stripped","unplugged"].some(e=>t.name.toLowerCase().includes(e))||.85<(null==(e=null==t?void 0:t.features)?void 0:e.acousticness)},callback:async e=>{await i(t(e.name)+" artist:"+e.artists[0].name)}},skipInstrumental:{menuTitle:"Instrumental Songs",check:e=>{return e.name.toLowerCase().includes("instrumental")||.4<(null==(e=null==e?void 0:e.features)?void 0:e.instrumentalness)}},skipRemix:{menuTitle:"Remix Songs",check:e=>e.name.toLowerCase().includes("remix"),callback:async e=>i(t(e.name)+" artist:"+e.artists[0].name)},skipLive:{menuTitle:"Live Songs",check:t=>{var e;return["- live","live version","(live)"].some(e=>t.name.toLowerCase().includes(e))||.8<(null==(e=null==t?void 0:t.features)?void 0:e.liveliness)},callback:async e=>i(t(e.name)+" artist:"+e.artists[0].name)},skipRadio:{menuTitle:"Radio/Censored songs",check:e=>e.name.toLowerCase().includes("radio edit"),callback:async e=>i(t(e.name)+" artist:"+e.artists[0].name)},skipExplicit:{menuTitle:"Explicit Songs",check:e=>!0===(null==e?void 0:e.explicit),callback:async e=>i(t(e.name)+" artist:"+e.artists[0].name)},skipChristmas:{menuTitle:"Christmas Songs",check:t=>["xmas","christmas","jingle","mistletoe","merry","santa","feliz","navidad"].some(e=>t.name.toLowerCase().includes(e))},skipLiked:{menuTitle:"Liked Songs",check:(e,t)=>null!==t&&"true"===t.metadata["collection.in_collection"]}};var a=async function(){for(;null==Spicetify||!Spicetify.Player||null==Spicetify||!Spicetify.Menu||null==Spicetify||!Spicetify.Queue;)await new Promise(e=>setTimeout(e,100));const i=e(),s=function(e){var t;null===localStorage.getItem("auto-skip:stats")&&localStorage.setItem("auto-skip:stats","{}");const i=JSON.parse(null!=(t=localStorage.getItem("auto-skip:stats"))?t:"{}");return Object.keys(e).filter(e=>void 0===i[e]).forEach(e=>i[e]=0),localStorage.setItem("auto-skip:stats",JSON.stringify(i)),i}(d);let l=null,u={};async function a(){var t,i,a,n=null==(n=null==(n=Spicetify.Player)?void 0:n.data)?void 0:n.track;if(n){let e;if(null!==(e=null===l||l.uri!==n.uri?await o(n.uri):l)){const r=c(e,n);0<r.length&&(t=r.map(e=>d[e].menuTitle).join(", "),u=(null==n?void 0:n.uri)===(null==u?void 0:u.uri)&&(null==n?void 0:n.uid)===(null==u?void 0:u.uid)?(i=`${null==(i=null==n?void 0:n.metadata)?void 0:i.title} was auto skipped due to ${t} filters.`,Spicetify.showNotification(i),console.log(i),{}):(r.forEach(e=>s[e]++),localStorage.setItem("auto-skip:stats",JSON.stringify(s)),(i=r.filter(e=>void 0!==d[e].callback)).length&&(Spicetify.Player.toggleMute(),l=null!=(i=await d[i[Math.floor(Math.random()*i.length)]].callback(e))?i:l,Spicetify.Player.toggleMute()),i=Object.values(s).reduce((e,t)=>e+t,0),a=`${null==(a=null==n?void 0:n.metadata)?void 0:a.title} skipped!Reasons: ${t}. Total skips = `+i,Spicetify.showNotification(a),console.log(a),Spicetify.Player.next(),n))}}}function n(e,t){return new Spicetify.Menu.Item(e,i[t],e=>{i[t]=!i[t],e.isEnabled=i[t],e=i,r=e,localStorage.setItem("auto-skip:skips",JSON.stringify(r)),a()})}Spicetify.Player.addEventListener("songchange",a),Spicetify.Player.origin._events.addListener("queue_update",async function({data:e}){var t;e.current&&(e.queued.length?l&&(null==l?void 0:l.uri)===(null==(t=null==e?void 0:e.queued[0])?void 0:t.uri)||null!=(t=null==e?void 0:e.queued[0])&&t.uri&&(l=await o(null==(t=null==e?void 0:e.queued[0])?void 0:t.uri)):l&&(null==l?void 0:l.uri)===(null==(t=null==e?void 0:e.nextUp[0])?void 0:t.uri)||null!=(t=null==e?void 0:e.nextUp[0])&&t.uri&&(l=await o(null==(t=null==e?void 0:e.nextUp[0])?void 0:t.uri)))}),a(),new Spicetify.Menu.SubMenu("Auto Skip",Object.entries(d).map(([e,t])=>n(t.menuTitle,e))).register()};(async()=>{await a()})()})();